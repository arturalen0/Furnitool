<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Couch AR Viewer</title>
    <script
      type="module"
      src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"
    ></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background: #000;
        overflow: hidden;
      }

      model-viewer {
        width: 100vw;
        height: 100vh;
        background-color: transparent;
      }

      #config-info {
        position: fixed;
        top: 20px;
        left: 20px;
        right: 20px;
        background: rgba(0, 0, 0, 0.9);
        color: white;
        padding: 20px;
        border-radius: 12px;
        backdrop-filter: blur(10px);
        z-index: 100;
        text-align: left;
        border: 2px solid rgba(255, 255, 255, 0.2);
      }

      #config-info h2 {
        font-size: 20px;
        margin-bottom: 15px;
        text-align: center;
        color: #fff;
      }

      .config-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 10px 0;
        padding: 8px 12px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
      }

      .config-label {
        font-weight: 600;
        color: #ccc;
      }

      .config-value {
        font-weight: 700;
        color: #fff;
        text-align: right;
      }

      .ar-button {
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        background: linear-gradient(135deg, #007aff, #0056cc);
        color: white;
        border: none;
        padding: 18px 36px;
        border-radius: 30px;
        font-size: 18px;
        font-weight: 700;
        cursor: pointer;
        box-shadow: 0 6px 25px rgba(0, 122, 255, 0.4);
        transition: all 0.3s ease;
        z-index: 100;
      }

      .ar-button:hover {
        background: linear-gradient(135deg, #0056cc, #003d99);
        transform: translateX(-50%) translateY(-3px);
        box-shadow: 0 8px 30px rgba(0, 122, 255, 0.5);
      }

      .ar-button:active {
        transform: translateX(-50%) translateY(-1px);
      }

      #loading {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        text-align: center;
        z-index: 50;
      }

      .spinner {
        width: 50px;
        height: 50px;
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top: 4px solid white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .feature-buttons {
        position: fixed;
        top: 20px;
        right: 20px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        z-index: 100;
      }

      .feature-btn {
        background: rgba(255, 255, 255, 0.9);
        border: none;
        padding: 12px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        min-width: 90px;
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
      }

      .feature-btn:hover {
        background: rgba(255, 255, 255, 1);
        transform: scale(1.05);
      }

      .material-note {
        margin-top: 15px;
        padding: 12px;
        background: rgba(255, 193, 7, 0.2);
        border: 1px solid rgba(255, 193, 7, 0.4);
        border-radius: 8px;
        font-size: 13px;
        text-align: center;
        color: #ffc107;
      }
    </style>
  </head>
  <body>
    <div id="loading">
      <div class="spinner"></div>
      <p>Loading your configured couch...</p>
    </div>

    <div id="config-info" style="display: none">
      <h2>üõãÔ∏è Your Couch Configuration</h2>
      <div class="config-item">
        <span class="config-label">Fabric Material:</span>
        <span class="config-value" id="fabric-value">Loading...</span>
      </div>
      <div class="config-item">
        <span class="config-label">Stitch Color:</span>
        <span class="config-value" id="stitch-value">Loading...</span>
      </div>
      <div class="config-item">
        <span class="config-label">Legs Material:</span>
        <span class="config-value" id="legs-value">Loading...</span>
      </div>
      <div class="material-note">
        <strong>üì± AR Preview:</strong> This shows the couch size and
        placement.<br />
        <strong>üé® Full Materials:</strong> View on desktop for detailed
        textures.
      </div>
    </div>

    <model-viewer
      id="couch-ar-viewer"
      src="couch.glb"
      alt="Configured Couch in AR"
      ar
      ar-modes="webxr scene-viewer quick-look"
      ar-scale="auto"
      camera-controls
      auto-rotate
      shadow-intensity="1"
      shadow-softness="0.5"
      exposure="1"
      environment-image="neutral"
      camera-orbit="45deg 75deg 2.5m"
      min-camera-orbit="auto auto 1m"
      max-camera-orbit="auto auto 6m"
      interaction-prompt="auto"
      loading="eager"
      reveal="auto"
    >
      <button slot="ar-button" class="ar-button">üëÅÔ∏è View in Your Space</button>
    </model-viewer>

    <div class="feature-buttons">
      <button class="feature-btn" onclick="toggleAutoRotate()">‚ü≤ Rotate</button>
      <button class="feature-btn" onclick="resetView()">üéØ Reset</button>
      <button class="feature-btn" onclick="shareConfig()">üì§ Share</button>
    </div>

    <script>
      const modelViewer = document.getElementById("couch-ar-viewer");
      const loadingDiv = document.getElementById("loading");
      const configInfo = document.getElementById("config-info");

      // Parse URL parameters to get configuration
      const urlParams = new URLSearchParams(window.location.search);
      const config = {
        fabric: urlParams.get("fabric") || "Cloud",
        stitch: urlParams.get("stitch") || "Cloud",
        legs: urlParams.get("legs") || "Rosewood Veneer",
      };

      console.log("AR Viewer loaded with config:", config);

      // Update configuration display immediately
      document.getElementById("fabric-value").textContent = config.fabric;
      document.getElementById("stitch-value").textContent = config.stitch;
      document.getElementById("legs-value").textContent = config.legs;

      // Show configuration info
      configInfo.style.display = "block";

      // Handle model loading
      modelViewer.addEventListener("load", () => {
        console.log("AR model loaded successfully");
        loadingDiv.style.display = "none";
      });

      modelViewer.addEventListener("error", (error) => {
        console.error("Model loading error:", error);
        loadingDiv.innerHTML =
          '<p style="color: red;">Failed to load 3D model</p>';
      });

      function toggleAutoRotate() {
        modelViewer.autoRotate = !modelViewer.autoRotate;
      }

      function resetView() {
        modelViewer.cameraOrbit = "45deg 75deg 2.5m";
        modelViewer.fieldOfView = "45deg";
      }

      function shareConfig() {
        if (navigator.share) {
          navigator.share({
            title: "Check out this couch configuration!",
            text: `Fabric: ${config.fabric}, Stitch: ${config.stitch}, Legs: ${config.legs}`,
            url: window.location.href,
          });
        } else {
          // Fallback: copy to clipboard
          navigator.clipboard.writeText(window.location.href).then(() => {
            alert("Configuration link copied to clipboard!");
          });
        }
      }

      // Auto-hide config info after 8 seconds
      setTimeout(() => {
        configInfo.style.opacity = "0";
        configInfo.style.transition = "opacity 0.5s ease";
      }, 8000);

      // Show config info on tap
      document.addEventListener("click", () => {
        if (configInfo.style.opacity === "0") {
          configInfo.style.opacity = "1";
          setTimeout(() => {
            configInfo.style.opacity = "0";
          }, 4000);
        }
      });
    </script>
  </body>
</html>
